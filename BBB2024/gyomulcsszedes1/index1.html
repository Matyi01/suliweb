<!DOCTYPE html>
<html lang="hu">

<head>
    <title>Számok</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <style type="text/css" media="screen,projection,print">
        body {
            font-family: Arial, Helvetica, sans-serif;
            margin: auto;
        }

        section {
            min-width: 400px;
            padding: 20px;
            margin: 10px auto 10px auto;
        }

        h1,
        p {
            text-align: center;
            line-height: 10px;
        }

        h1 {
            color: #1f2839;
            font-size: 2.5em;
            text-shadow: 6px 6px 2px #d0d0d0;
        }

        #palya {
            background: orange;
            font-size: 2em;
            text-align: center;
            margin: auto;
            border-color: orange;
            box-shadow: 10px 10px 5px #d0d0d0;
        }

        button {
            background-color: cornflowerblue;
            border: none;
            color: white;
            padding: 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <section>
        <h1>Játék</h1>

        <button onclick="location.href = 'index.html';">Szabályzat</button>

        <p>Hátralévő lépésszám:</p>
        <p id="hatralevo"></p>

        <p>Pontoszám:</p>
        <p id="score">0</p>

        <p>Legjobb pontszám:</p>
        <p id="highscore">0</p>

        <table id="palya"></table>

        <button onclick="ujra()" id="reset">Pálya visszatöltése</button>

        <p>Képességek:</p>
        <button onclick="teleport()" id="tp">Teleportálás</button>
        <button onclick="pluszegy()" id="plusz">Látótávolság növelés</button>
        <button onclick="kereszt()" id="cross">Függ/vízsz</button>

    </section>
    <script>
        var nrow = 8;
        var ncell = 8;
        var tt = new Array(nrow);
        var newrow;
        let lepes = Math.floor(Math.random() * 10) + 5;
        const eredetilepes = lepes;
        let row = 0;
        let column = 0;
        let szolok = ["szolo1", "szolo2", "szolo3", "szolo4", "szolo5", "szolo6"];
        let ertekek = [16, 8, 9, 13, 10, 10];

        function init() {
            document.getElementById("hatralevo").innerHTML += lepes;
            for (var i = 0; i < nrow; i++) {
                newrow = document.getElementById("palya").insertRow(i);
                tt[i] = new Array(ncell);
                for (var j = 0; j < ncell; j++) {
                    tt[i][j] = newrow.insertCell(j);
                    tt[i][j].id = i * ncell + j;
                    tt[i][j].onclick = function () {
                        cellClicked(this);
                    };
                    tt[i][j].style.width = "50px";
                    tt[i][j].style.height = "50px";
                    tt[i][j].style.color = "#fcfcfc";
                    tt[i][j].dataset.aktiv = 0;
                    let random = Math.floor(Math.random() * szolok.length);
                    tt[i][j].innerHTML = '<img src="' + szolok[random] + '.png" style="width: 100%; height: 100%; object-fit: cover; display: block; position: relative">';
                    tt[i][j].dataset.ertek = random;
                    tt[i][j].dataset.aktivertek = ertekek[random];
                }
            }
        }

        function clearBackground() {
            for (var i = 0; i < nrow; i++) {
                for (var j = 0; j < ncell; j++) {
                    tt[i][j].dataset.aktiv = 0;
                    tt[i][j].lastChild.style.filter = "brightness(100%)";
                }
            }
        }

        function cellClicked(obj) {
            if (eredetilepes === lepes) {
                aktivmezo(obj);
            }
            else if (obj.dataset.aktiv == 1 && lepes >= 0) {
                aktivmezo(obj);
                if (lepes === -1) {
                    if (document.getElementById("highscore").innerHTML < document.getElementById("score").innerHTML) {
                        document.getElementById("highscore").innerHTML = document.getElementById("score").innerHTML;
                    }
                }
            }
        }

        function cellClickable() {
            if (row !== nrow - 1) {
                tt[row + 1][column].dataset.aktiv = 1;
                tt[row + 1][column].lastChild.style.filter = "brightness(75%)";
            }
            if (column !== 0) {
                tt[row][column - 1].dataset.aktiv = 1;
                tt[row][column - 1].lastChild.style.filter = "brightness(75%)";
            }
            if (column !== ncell - 1) {
                tt[row][column + 1].dataset.aktiv = 1;
                tt[row][column + 1].lastChild.style.filter = "brightness(75%)";
            }
            if (row !== 0) {
                tt[row - 1][column].dataset.aktiv = 1;
                tt[row - 1][column].lastChild.style.filter = "brightness(75%)";
            }
        }

        function aktivmezo(obj) {
            if (lepes !== eredetilepes) {
                tt[row][column].innerHTML = '<img src="dead.png" style="width: 100%; height: 100%; object-fit: cover; display: block; position: relative">';
            }

            clearBackground();

            row = parseInt(obj.id / ncell);
            column = obj.id % ncell;
            tt[row][column].dataset.aktiv = 2;

            cellClickable();

            document.getElementById("hatralevo").innerHTML = lepes--;
            document.getElementById("score").innerHTML = Number(document.getElementById("score").innerHTML) + Number(tt[row][column].dataset.aktivertek);

            tt[row][column].innerHTML = '<img src="kosar.jpeg" style="width: 100%; height: 100%; object-fit: cover; display: block; position: relative">';
            tt[row][column].dataset.aktivertek = 0;
        }

        function ujra() {
            if (document.getElementById("highscore").innerHTML < document.getElementById("score").innerHTML) {
                document.getElementById("highscore").innerHTML = document.getElementById("score").innerHTML;
            }

            lepes = eredetilepes;
            document.getElementById("hatralevo").innerHTML = lepes;
            document.getElementById("score").innerHTML = 0;

            for (var i = 0; i < nrow; i++) {
                for (var j = 0; j < ncell; j++) {
                    tt[i][j].dataset.aktiv = 0;
                    tt[i][j].lastChild.style.filter = "brightness(100%)";
                    tt[i][j].innerHTML = '<img src="' + szolok[tt[i][j].dataset.ertek] + '.png" style="width: 100%; height: 100%; object-fit: cover; display: block; position: relative">';
                }
            }

            document.getElementById("tp").style.display = "inline-block";
            document.getElementById("plusz").style.display = "inline-block";
            document.getElementById("cross").style.display = "inline-block";
        }

        function teleport() {
            for (var i = 0; i < nrow; i++) {
                for (var j = 0; j < ncell; j++) {
                    tt[i][j].dataset.aktiv = 1;
                    tt[i][j].lastChild.style.filter = "brightness(75%)";
                }
            }

            tt[row][column].dataset.aktiv = 2;
            document.getElementById("tp").style.display = "none";
        }

        function pluszegy() {
            if (row < nrow - 2) {
                tt[row + 2][column].dataset.aktiv = 1;
                tt[row + 2][column].lastChild.style.filter = "brightness(75%)";
            }
            if (column > 1) {
                tt[row][column - 2].dataset.aktiv = 1;
                tt[row][column - 2].lastChild.style.filter = "brightness(75%)";
            }
            if (column < ncell - 2) {
                tt[row][column + 2].dataset.aktiv = 1;
                tt[row][column + 2].lastChild.style.filter = "brightness(75%)";
            }
            if (row > 1) {
                tt[row - 2][column].dataset.aktiv = 1;
                tt[row - 2][column].lastChild.style.filter = "brightness(75%)";
            }

            document.getElementById("plusz").style.display = "none";
        }

        function kereszt() {
            for (var i = 0; i < nrow; i++) {
                for (var j = 0; j < ncell; j++) {
                    if (i === row || j === column) {
                        tt[i][j].dataset.aktiv = 1;
                        tt[i][j].lastChild.style.filter = "brightness(75%)";
                    }
                }
            }

            tt[row][column].dataset.aktiv = 2;
            document.getElementById("cross").style.display = "none";
        }
    </script>
    <script>
        init();
    </script>
</body>

</html>